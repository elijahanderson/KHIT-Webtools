{% extends "layout.html" %}
{% block content %}
    <div class="main-header" id="isl-content">
	<h1>ISL Jobs</h1>
        <br>
	{% if jobs %}
	    <table>
            	<colgroup>
		    <col span="1" style="width: 60%">
		    <col span="1" style="width: 20%">
		    <col span="1" style="width: 20%">
  	        </colgroup>
	        <tbody>
		    <tr>
			<th>ID</th>
			<th>Date</th>
			<th>Status</th>
		    </tr>
		    {% set i = 0 %}
	            {% for job_id, data in jobs.items() %}	
		    <tr>
		        <td>{{ job_id }}</td>
		    	<td>{{ data['from_date'] }}</td>
		        <br>
			<td id={{ "queued-" + i|string }} style="display: inline">queued</td>
			<td id={{ "started-" + i|string }} style="display: none">
			    <img src="static/loader.gif" alt="started">
			</td>
			<td id={{ "finished-" + i|string }} style="display: none">finished</td>
			<td>{{ data['result'] }}</td>

		        <br>
		    </tr>
		    {% set i = i + 1 %}
		    {% endfor %}
		</tbody>
	    </table>
	{% endif %}
    </div>
    <script language="JavaScript">
	    function statusListener() {
                setInterval(getStatus, 5000);
            }
            function getStatus() {
		var reader = new FileReader();
		var jobs_txt = reader.readAsText('json/jobs.json');
		var jobs = JSON.parse(jobs_txt);

		for (var job_id in jobs) {
		    if (jobs[job_id]['status'] == 'started') {
                    	document.getElementById('queued-'+i.toString()).style.display = "none";
			document.getElementById('started-'+i.toString()).style.display = "inline";
			document.getElementById('finished-'+i.toString()).style.display = "none";
		    }
		    else if (jobs[job_id]['status'] == 'finished') {
                        document.getElementById('queued-'+i.toString()).style.display = "none";
                        document.getElementById('started-'+i.toString()).style.display = "none";
                        document.getElementById('finished-'+i.toString()).style.display = "inline";
                    }
		}
            }
	    window.onload = statusListener;
    </script>
{% endblock content %}
